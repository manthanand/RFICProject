; Top Design: "ECE382M:Testbench:schematic"
; Netlisted using Hierarchy Policy: "Standard"

Options ResourceUsage=yes UseNutmegFormat=no EnableOptim=no TopDesignName="ECE382M:Testbench:schematic" DcopOutputNodeVoltages=yes DcopOutputPinCurrents=yes DcopOutputAllSweepPoints=no DcopOutputDcopType=0
; Library Name: ECE382M
; Cell Name: LNA_wrk
; View Name: schematic
define LNA_wrk ( Vb  Vdd  Vinn  Vinp  Voutn  Voutp ) 
;parameters 
#ifndef inc_ECE382M_3aLNA__wrk_3aschematic__130nm__bulk_2enet
#define inc_ECE382M_3aLNA__wrk_3aschematic__130nm__bulk_2enet 1
#include "C:\Users\manth\Github\RFICProject\ECE382M_wrk\130nm_bulk.net"
#endif
#uselib "ckt" , "INDQ_Z"
INDQ_Z:L8  Vdd Voutn L=Ldrain nH notune{ 5 nH to 20 nH by 1 nH } Q=15 F=3.75 GHz notune{ 1.875 GHz to 5.625 GHz by 0.375 GHz } Mode=1 Rdc=0.0 Ohm 
#uselib "ckt" , "INDQ_Z"
INDQ_Z:L5  Vdd Voutp L=Ldrain nH notune{ 5 nH to 20 nH by 1 nH } Q=15 F=3.75 GHz notune{ 1.875 GHz to 5.625 GHz by 0.375 GHz } Mode=1 Rdc=0.0 Ohm 

width=19.5 tune{ 1 to 40 by 1 } opt{ 1 to 40 }
ctop=65 f tune{ 0.5 f to 1000 f by 1 f } opt{ 0 to 1e-12 }
Rdrain=300 tune{ 0 to 1000 by 10 } opt{ 1 to 1000 }
len=285 tune{ 130 to 1000 by 10 } opt{ 130 to 1000 }
Ldrain=7.2 tune{ 0 to 10 by 0.1 } opt{ 4 to 9 }
num=15 tune{ 1 to 40 by 1 } opt{ 1 to 40 }
"nmos":MOSFET4  Voutp Vb Vinp 0 Length=len nm Width=width um Mode=1 Noise=yes _M=num 
#uselib "ckt" , "INDQ_Z"
INDQ_Z:L7  Vinn 0 L=(10 - Ldrain) nH Q=15 F=3.75 GHz Mode=1 Rdc=0.0 Ohm 
"nmos":MOSFET2  Voutn Vb Vinn 0 Length=len nm Width=width um Mode=1 Noise=yes _M=num 
#uselib "ckt" , "INDQ_Z"
INDQ_Z:L6  Vinp 0 L=(10 - Ldrain) nH Q=15 F=3.75 GHz Mode=1 Rdc=0.0 Ohm 
CAPQ:C3  Vb Voutp C=ctop F Q=50.0 F=3.75 GHz Mode=1 
CAPQ:C4  Vb Voutn C=ctop F Q=50.0 F=3.75 GHz Mode=1 
R:R10  Vdd Voutn R=Rdrain Ohm Noise=yes 
R:R9  Vdd Voutp R=Rdrain Ohm Noise=yes 
end LNA_wrk

; Library Name: ECE382M
; Cell Name: mixer
; View Name: schematic
define mixer ( LOn  LOp  Vb  Vinn  Vinp  Voutn  Voutp ) 
;parameters 
#ifndef inc_ECE382M_3amixer_3aschematic__130nm__bulk_2enet
#define inc_ECE382M_3amixer_3aschematic__130nm__bulk_2enet 1
#include "C:\Users\manth\Github\RFICProject\ECE382M_wrk\130nm_bulk.net"
#endif
R:R3  LOp Vb R=200 kOhm Noise=yes 
R:R2  Voutn 0 R=load Ohm Noise=yes 
R:R1  Voutp 0 R=load Ohm Noise=yes 
"nmos":MOSFET2  Vinn LOn Voutp 0 Length=130 nm Width=width um Mult=30 Mode=1 Noise=yes 
"nmos":MOSFET4  Vinn LOp Voutn 0 Length=130 nm Width=width um Mult=30 Mode=1 Noise=yes 
"nmos":MOSFET1  Vinp LOp Voutp 0 Length=130 nm Width=width um Mult=30 Mode=1 Noise=yes 
"nmos":MOSFET3  Vinp LOn Voutn 0 Length=130 nm Width=width um Mult=30 Mode=1 Noise=yes 
R:R4  LOn Vb R=200 kOhm Noise=yes 

width=1 notune{ 0.1 to 100 by 1 }
load=200 k notune{ 100 k to 10000 k by 100 k }
end mixer

V_Source:SRC1  N__17 0 Type="V_1Tone" V[1]=polar(1.2,0) V Freq[1]=LOfreq GHz    Vac=polar(1,0) V SaveCurrent=1 
V_Source:SRC2  N__19 0 Type="V_1Tone" V[1]=polar(1.2,180) V Freq[1]=LOfreq GHz    Vac=polar(1,0) V SaveCurrent=1 
C:C4  N__19 LO_In C=1 nF 
C:C3  N__17 LO_Ip C=1 nF 
Port:PORT3  N__12 0 Num=1  Z=50 Ohm  Freq[1]=(RFfreq+df/2) GHz Freq[2]=(RFfreq-df/2) GHz    P[1]=polar(dbmtow(RFpower),0) P[2]=polar(dbmtow(RFpower),0) Noise=yes Pac=polar(dbmtow(0),0) 

RFfreq=2.4
rtest=50 notune{ 25 to 10000 by 100 }
IFfreq=0.05
df=0.01
LOfreq=RFfreq-IFfreq
RFpower=-50
#uselib "ckt" , "Balun3Port"
Balun3Port:CMP1  Vout Vout1 Vout2 
HB:HB5 MaxOrder=9 Freq[1]=LOfreq GHz Freq[2]=(RFfreq+df/2) GHz Freq[3]=(RFfreq-df/2) GHz Order[1]=7 Order[2]=4 Order[3]=4 StatusLevel=4 FundOversample=1 \
Restart=no OutputBudgetIV=no \
HBSS_WSP=0 SweepVar="RFfreq" SweepPlan="HB5_stim" OutputPlan="HB5_Output" 

SweepPlan: HB5_stim Start=2 Stop=5 Step=0.1 

OutputPlan:HB5_Output \
      Type="Output" \
      UseNodeNestLevel=yes \
      NodeNestLevel=2 \
      UseEquationNestLevel=yes \
      EquationNestLevel=2 \
      UseSavedEquationNestLevel=yes \
      SavedEquationNestLevel=2 \
      SavedEquationName[1]="IFfreq" \
      SavedEquationName[2]="LOfreq" \
      UseDeviceCurrentNestLevel=no \
      DeviceCurrentNestLevel=0 \
      DeviceCurrentDeviceType="All" \
      DeviceCurrentSymSyntax=yes \
      UseCurrentNestLevel=yes \
      CurrentNestLevel=999 \
      UseDeviceVoltageNestLevel=no \
      DeviceVoltageNestLevel=0 \
      DeviceVoltageDeviceType="All"

Tran:HB5_tran HB_Sol=1 SteadyState=1 StatusLevel=3 \
Freq[1]=LOfreq GHz Order[1]=7 

Component:tahb_HB5 Module="ATAHB" Type="ModelExtractor" \ 
 Tran_Analysis="HB5_tran" HB_Analysis="HB5" 

aele IF_high_linear=mag(mix(HB.Vout,{-1,1,0}));IF_low_linear=mag(mix(HB.Vout,{-1,0,1}));IM3_high_linear=mag(mix(HB.Vout,{-1,2,-1}));IM3_low_linear=mag(mix(HB.Vout,{-1,-1,2}));IF_high_dB=20*log(IF_high_linear);IF_low_dB=20*log(IF_low_linear);IM3_high_dB=20*log(IM3_high_linear);IM3_low_dB=20*log(IM3_low_linear);IIP3_high=(IF_high_dB-IM3_high_dB)/2+RFpower;IIP3_low=(IF_low_dB-IM3_low_dB)/2+RFpower;
Port:Term2  Vout 0 Num=2 Z=100 kOhm Noise=yes 
Short:DC_Block2  N__12 vin Mode=1 
V_Source:SRC3  N__23 0 Type="V_DC" Vdc=0.8 V tune{ 0.5 V to 2.5 V by 0.1 V } SaveCurrent=1 
V_Source:SRC6  N__27 0 Type="V_1Tone" V[1]=polar(1.2,90) V Freq[1]=LOfreq GHz    Vac=polar(1,0) V SaveCurrent=1 
C:C5  N__27 LO_Qp C=1 nF 
C:C6  N__30 LO_Qn C=1 nF 
V_Source:SRC5  N__30 0 Type="V_1Tone" V[1]=polar(1.2,270) V Freq[1]=LOfreq GHz    Vac=polar(1,0) V SaveCurrent=1 
Port:Term3  VoutQ 0 Num=3 Z=100 kOhm Noise=yes 
#uselib "ckt" , "Balun3Port"
Balun3Port:CMP2  VoutQ N__15 N__16 
LNA_wrk:X6  N__26 N__23 N P N__11 N__24 
#uselib "ckt" , "Balun3Port"
Balun3Port:CMP3  vin P N 
V_Source:SRC7  Vb 0 Type="V_DC" Vdc=.3 V SaveCurrent=1 
mixer:X5  LO_In LO_Ip Vb N__11 N__24 Vout2 Vout1 
mixer:X4  LO_Qn LO_Qp Vb N__11 N__24 N__16 N__15 
V_Source:SRC8  N__26 0 Type="V_DC" Vdc=0.8 V tune{ 0.4 V to 1.2 V by 0.1 V } SaveCurrent=1 
